<div class="container">
<br>
  <h1 class="text-center mb-4">Browse All Resources</h1>

<div class="row">
  <div class="col-12">
    <%= form_with(url: browse_resources_path, method: :get, local: true, class: "d-flex mt-3") do |form| %> 
      <%= form.text_field :query, 
                          value: params[:query],
                          class: "form-control me-2", 
                          placeholder: "Find resources by subject or topic" %>

      <div class="input-group-append">
        <%= form.submit "Search", class: "btn btn-outline-success" %>
      </div>
    <% end %>
  </div>
</div>

<br>

<%= form_with(url: browse_resources_path, method: :get, local: true, class: "d-flex justify-content-start align-items-center mb-4") do |form| %>

  <!-- Keep the keyword search query hidden so it persists when filters are used -->
  <%= hidden_field_tag :query, params[:query] %>
  
  <div class="me-3">
    <%= select_tag :subject, 
                    options_for_select(['Maths', 'Science', 'History', 'English', 'Economics', 'Geography'], params[:subject]), 
                    { include_blank: 'Filter by Subject', class: 'form-select', onchange: 'this.form.submit();' } %>
  </div>

  <div class="me-3">
    <%= select_tag :level, 
                    options_for_select(['GCSE', 'A-Level', 'Undergraduate', 'Postgraduate'], params[:level]), 
                    { include_blank: 'Filter by Level', class: 'form-select', onchange: 'this.form.submit();' } %>
  </div>

  <div class="me-3">
    <%= select_tag :resource_type, 
                    options_for_select(['Document', 'Video', 'Quiz', 'Website', 'TedTalk', 'Forum'], params[:resource_type]), 
                    { include_blank: 'Filter by Type', class: 'form-select', onchange: 'this.form.submit();' } %>
  </div>

<% end %>

  <% if @resources.any? %>
  <div class="row">
    <% @resources.each do |resource| %>
    <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
      <div class="card h-100">
        <div class="card-body">
          <h4 class="card-title"><%= resource.title %></h4>
          <h5 class="card-subtitle mb-2 text-body-secondary"><%= resource.subject %></h5>
          <h6 class="card-subtitle mb-2 text-body-secondary"><%= resource.grade_level %></h6>
          <h6 class="card-subtitle mb-2 text-body-secondary"><%= resource.resource_type %></h6>
          <p class="card-text"><%= resource.description %></p>
          <a href="<%= resource.upload_file_or_link %>" class="card-link" target="_blank">Link to Resource</a>

<% if resource.description.length > 200 %>
  <button class="btn btn-link read-more-btn" data-target-id="description-<%= resource.id %>">
    Read More
  </button>
<% end %>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.read-more-btn').forEach(button => {
      button.addEventListener('click', function() {
        const targetId = this.getAttribute('data-target-id');
        const descriptionElement = document.getElementById(targetId);
        const isExpanded = descriptionElement.classList.toggle('expanded');
        
        if (isExpanded) {
          this.textContent = 'Read Less';
        } else {
          this.textContent = 'Read More';
        }
      });
    });
  });
</script>
        </div>
      </div>
    </div>
    <% end %>
  <% else %>
    <p class="text-center">No resources uploaded yet.</p>
  <% end %>

  <div class="text-center mt-4">
    <%= link_to "Upload New Resource", new_resource_path, class: "btn btn-primary" %>
  </div>
    <br>
</div>
</div>
